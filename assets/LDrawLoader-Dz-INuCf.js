import"./three-module-Bzb5U4JC.js";import{a4 as z,M as W,r as se,a6 as Q,Z as De,o as ne,V as B,G as Se,i as Ne,ft as pe,u as _e,a3 as j,ar as fe,c as xe}from"./three-core-S_L7YPKV.js";const oe=0,ie=1,le=2,ce=3,he=4,ue=5,X=0,Oe=1,Re=2,Ve=3,Pe=4,Ue=5,de=6,P="16",G="24",q=De,$=new B,K=new B;class We extends fe{constructor(e,t){super(e,t),this.isConditionalLine=!0}}function Be(I){for(let e=0,t=I.length;e<t;e++){const r=I[e],s=r.vertices,h=s[0],f=s[1],o=s[2];$.subVectors(f,h),K.subVectors(o,f),r.faceNormal=new B().crossVectors($,K).normalize()}}const ge=new pe;function Ge(I,e,t=!1){const r=100.00000001000001;function s(n){const E=~~(n.x*r),m=~~(n.y*r),u=~~(n.z*r);return`${E},${m},${u}`}function h(n,E){return`${s(n)}_${s(E)}`}function f(n,E,m){m.direction.subVectors(E,n).normalize();const u=n.dot(m.direction);return m.origin.copy(n).addScaledVector(m.direction,-u),m}function o(n){return h(n.origin,n.direction)}const l=new Set,i=new Map,F={},y=[];for(let n=0,E=e.length;n<E;n++){const u=e[n].vertices,d=u[0],L=u[1];if(l.add(h(d,L)),l.add(h(L,d)),t){const C=f(d,L,new pe),p=o(C);if(!i.has(p)){f(L,d,C);const T=o(C),S={ray:C,distances:[]};i.set(p,S),i.set(T,S)}const M=i.get(p);let w=M.ray.direction.dot(d),k=M.ray.direction.dot(L);w>k&&([w,k]=[k,w]),M.distances.push(w,k)}}for(let n=0,E=I.length;n<E;n++){const m=I[n],u=m.vertices,d=u.length;for(let L=0;L<d;L++){const C=L,p=(L+1)%d,M=u[C],w=u[p],k=h(M,w);if(l.has(k))continue;if(t){f(M,w,ge);const S=o(ge);if(i.has(S)){const A=i.get(S),{ray:v,distances:a}=A;let b=v.direction.dot(M),g=v.direction.dot(w);b>g&&([b,g]=[g,b]);let c=!1;for(let D=0,N=a.length;D<N;D+=2)if(b>=a[D]&&g<=a[D+1]){c=!0;break}if(c)continue}}const T={index:C,tri:m};F[k]=T}}for(;;){let n=null;for(const m in F){n=F[m];break}if(n===null)break;const E=[n];for(;E.length>0;){const m=E.pop().tri,u=m.vertices,d=m.normals,L=m.faceNormal,C=u.length;for(let p=0;p<C;p++){const M=p,w=(p+1)%C,k=u[M],T=u[w],S=h(k,T);delete F[S];const A=h(T,k),v=F[A];if(v){const a=v.tri,b=v.index,g=a.normals,c=g.length,D=a.faceNormal;if(Math.abs(a.faceNormal.dot(m.faceNormal))<.25)continue;A in F&&(E.push(v),delete F[A]);const N=(b+1)%c;d[M]&&g[N]&&d[M]!==g[N]&&(g[N].norm.add(d[M].norm),d[M].norm=g[N].norm);let x=d[M]||g[N];x===null&&(x={norm:new B},y.push(x.norm)),d[M]===null&&(d[M]=x,x.norm.add(L)),g[N]===null&&(g[N]=x,x.norm.add(D)),d[w]&&g[b]&&d[w]!==g[b]&&(g[b].norm.add(d[w].norm),d[w].norm=g[b].norm);let _=d[w]||g[b];_===null&&(_={norm:new B},y.push(_.norm)),d[w]===null&&(d[w]=_,_.norm.add(L)),g[b]===null&&(g[b]=_,_.norm.add(D))}}}}for(let n=0,E=y.length;n<E;n++)y[n].normalize()}function me(I){return I==="Part"||I==="Unofficial_Part"}function je(I){return/primitive/i.test(I)||I==="Subpart"}class H{constructor(e,t){this.line=e,this.lineLength=e.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=t}seekNonSpace(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex),this.currentChar!==" "&&this.currentChar!=="	")return;this.currentCharIndex++}}getToken(){const e=this.currentCharIndex++;for(;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex),!(this.currentChar===" "||this.currentChar==="	"));)this.currentCharIndex++;const t=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(e,t)}getVector(){return new B(parseFloat(this.getToken()),parseFloat(this.getToken()),parseFloat(this.getToken()))}getRemainingString(){return this.line.substring(this.currentCharIndex,this.lineLength)}isAtTheEnd(){return this.currentCharIndex>=this.lineLength}setToEnd(){this.currentCharIndex=this.lineLength}getLineNumberString(){return this.lineNumber>=0?" at line "+this.lineNumber:""}}class He{constructor(e){this.loader=e,this._cache={}}cloneResult(e){const t={};return t.faces=e.faces.map(r=>({colorCode:r.colorCode,material:r.material,vertices:r.vertices.map(s=>s.clone()),normals:r.normals.map(()=>null),faceNormal:null})),t.conditionalSegments=e.conditionalSegments.map(r=>({colorCode:r.colorCode,material:r.material,vertices:r.vertices.map(s=>s.clone()),controlPoints:r.controlPoints.map(s=>s.clone())})),t.lineSegments=e.lineSegments.map(r=>({colorCode:r.colorCode,material:r.material,vertices:r.vertices.map(s=>s.clone())})),t.type=e.type,t.category=e.category,t.keywords=e.keywords,t.author=e.author,t.subobjects=e.subobjects,t.fileName=e.fileName,t.totalFaces=e.totalFaces,t.startingBuildingStep=e.startingBuildingStep,t.materials=e.materials,t.group=null,t}async fetchData(e){let t=!1,r=X;for(;r!==de;){let s=e;switch(r){case Ve:r=r+1;break;case X:s="parts/"+s,r=r+1;break;case Oe:s="p/"+s,r=r+1;break;case Re:s="models/"+s,r=r+1;break;case Pe:s=e.substring(0,e.lastIndexOf("/")+1)+s,r=r+1;break;case Ue:t?r=de:(e=e.toLowerCase(),s=e,t=!0,r=X);break}const h=this.loader,f=new Q(h.manager);f.setPath(h.partsLibraryPath),f.setRequestHeader(h.requestHeader),f.setWithCredentials(h.withCredentials);try{return await f.loadAsync(s)}catch{continue}}throw new Error('LDrawLoader: Subobject "'+e+'" could not be loaded.')}parse(e,t=null){const r=this.loader,s=[],h=[],f=[],o=[],l={},i=A=>l[A]||null;let F="Model",y=null,n=null,E=null,m=0;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`));const u=e.split(`
`),d=u.length;let L=!1,C=null,p=null,M=!1,w=!0,k=!1,T=!0,S=!1;for(let A=0;A<d;A++){const v=u[A];if(v.length===0)continue;if(L){v.startsWith("0 FILE ")?(this.setData(C,p),C=v.substring(7),p=""):p+=v+`
`;continue}const a=new H(v,A+1);if(a.seekNonSpace(),a.isAtTheEnd())continue;const b=a.getToken();let g,c,D,N,x,_,O,V,Y,ee,te;switch(b){case"0":const re=a.getToken();if(re)switch(re){case"!LDRAW_ORG":F=a.getToken();break;case"!COLOUR":g=r.parseColorMetaDirective(a),g?l[g.userData.code]=g:console.warn("LDrawLoader: Error parsing material"+a.getLineNumberString());break;case"!CATEGORY":y=a.getToken();break;case"!KEYWORDS":const ae=a.getRemainingString().split(",");ae.length>0&&(n||(n=[]),ae.forEach(function(U){n.push(U.trim())}));break;case"FILE":A>0&&(L=!0,C=a.getRemainingString(),p="",M=!1,w=!0);break;case"BFC":for(;!a.isAtTheEnd();){const U=a.getToken();switch(U){case"CERTIFY":case"NOCERTIFY":M=U==="CERTIFY",w=!0;break;case"CW":case"CCW":w=U==="CCW";break;case"INVERTNEXT":k=!0;break;case"CLIP":case"NOCLIP":T=U==="CLIP";break;default:console.warn('THREE.LDrawLoader: BFC directive "'+U+'" is unknown.');break}}break;case"STEP":S=!0;break;case"Author:":E=a.getToken();break}break;case"1":c=a.getToken(),g=i(c);const Ce=parseFloat(a.getToken()),Le=parseFloat(a.getToken()),Me=parseFloat(a.getToken()),we=parseFloat(a.getToken()),be=parseFloat(a.getToken()),Ee=parseFloat(a.getToken()),ye=parseFloat(a.getToken()),ke=parseFloat(a.getToken()),Te=parseFloat(a.getToken()),Fe=parseFloat(a.getToken()),Ie=parseFloat(a.getToken()),ve=parseFloat(a.getToken()),Ae=new Ne().set(we,be,Ee,Ce,ye,ke,Te,Le,Fe,Ie,ve,Me,0,0,0,1);let R=a.getRemainingString().trim().replace(/\\/g,"/");r.fileMap[R]?R=r.fileMap[R]:R.startsWith("s/")?R="parts/"+R:R.startsWith("48/")&&(R="p/"+R),o.push({material:g,colorCode:c,matrix:Ae,fileName:R,inverted:k,startingBuildingStep:S}),S=!1,k=!1;break;case"2":c=a.getToken(),g=i(c),_=a.getVector(),O=a.getVector(),D={material:g,colorCode:c,vertices:[_,O]},h.push(D);break;case"5":c=a.getToken(),g=i(c),_=a.getVector(),O=a.getVector(),ee=a.getVector(),te=a.getVector(),D={material:g,colorCode:c,vertices:[_,O],controlPoints:[ee,te]},f.push(D);break;case"3":c=a.getToken(),g=i(c),N=w,x=!M||!T,N===!0?(_=a.getVector(),O=a.getVector(),V=a.getVector()):(V=a.getVector(),O=a.getVector(),_=a.getVector()),s.push({material:g,colorCode:c,faceNormal:null,vertices:[_,O,V],normals:[null,null,null]}),m++,x===!0&&(s.push({material:g,colorCode:c,faceNormal:null,vertices:[V,O,_],normals:[null,null,null]}),m++);break;case"4":c=a.getToken(),g=i(c),N=w,x=!M||!T,N===!0?(_=a.getVector(),O=a.getVector(),V=a.getVector(),Y=a.getVector()):(Y=a.getVector(),V=a.getVector(),O=a.getVector(),_=a.getVector()),s.push({material:g,colorCode:c,faceNormal:null,vertices:[_,O,V,Y],normals:[null,null,null,null]}),m+=2,x===!0&&(s.push({material:g,colorCode:c,faceNormal:null,vertices:[Y,V,O,_],normals:[null,null,null,null]}),m+=2);break;default:throw new Error('LDrawLoader: Unknown line type "'+b+'"'+a.getLineNumberString()+".")}}return L&&this.setData(C,p),{faces:s,conditionalSegments:f,lineSegments:h,type:F,category:y,keywords:n,author:E,subobjects:o,totalFaces:m,startingBuildingStep:S,materials:l,fileName:t,group:null}}getData(e,t=!0){const r=e.toLowerCase(),s=this._cache[r];return s===null||s instanceof Promise?null:t?this.cloneResult(s):s}async ensureDataLoaded(e){const t=e.toLowerCase();t in this._cache||(this._cache[t]=this.fetchData(e).then(r=>{const s=this.parse(r,e);return this._cache[t]=s,s})),await this._cache[t]}setData(e,t){const r=e.toLowerCase();this._cache[r]=this.parse(t,e)}}function Z(I,e,t,r){return(!r&&I===P||r&&I===G)&&(I=e),t[I]||null}class Ye{constructor(e){this.loader=e,this.parseCache=new He(e),this._cache={}}async processIntoMesh(e){const t=this.loader,r=this.parseCache,s=new Set,h=async(o,l=null)=>{const i=o.subobjects,F=[];for(let E=0,m=i.length;E<m;E++){const u=i[E],d=r.ensureDataLoaded(u.fileName).then(()=>{const L=r.getData(u.fileName,!1);return je(L.type)?h(r.getData(u.fileName),u):this.loadModel(u.fileName).catch(C=>(console.warn(C),null))});F.push(d)}const y=new Se;y.userData.category=o.category,y.userData.keywords=o.keywords,y.userData.author=o.author,y.userData.type=o.type,y.userData.fileName=o.fileName,o.group=y;const n=await Promise.all(F);for(let E=0,m=n.length;E<m;E++){const u=o.subobjects[E],d=n[E];if(d===null)continue;if(d.isGroup){const b=d;u.matrix.decompose(b.position,b.quaternion,b.scale),b.userData.startingBuildingStep=u.startingBuildingStep,b.name=u.fileName,t.applyMaterialsToMesh(b,u.colorCode,o.materials),b.userData.colorCode=u.colorCode,y.add(b);continue}d.group.children.length&&y.add(d.group);const L=o.lineSegments,C=o.conditionalSegments,p=o.faces,M=d.lineSegments,w=d.conditionalSegments,k=d.faces,T=u.matrix,S=u.inverted,A=T.determinant()<0,v=u.colorCode,a=v===P?G:v;for(let b=0,g=M.length;b<g;b++){const c=M[b],D=c.vertices;D[0].applyMatrix4(T),D[1].applyMatrix4(T),c.colorCode=c.colorCode===G?a:c.colorCode,c.material=c.material||Z(c.colorCode,c.colorCode,o.materials,!0),L.push(c)}for(let b=0,g=w.length;b<g;b++){const c=w[b],D=c.vertices,N=c.controlPoints;D[0].applyMatrix4(T),D[1].applyMatrix4(T),N[0].applyMatrix4(T),N[1].applyMatrix4(T),c.colorCode=c.colorCode===G?a:c.colorCode,c.material=c.material||Z(c.colorCode,c.colorCode,o.materials,!0),C.push(c)}for(let b=0,g=k.length;b<g;b++){const c=k[b],D=c.vertices;for(let N=0,x=D.length;N<x;N++)D[N].applyMatrix4(T);c.colorCode=c.colorCode===P?v:c.colorCode,c.material=c.material||Z(c.colorCode,v,o.materials,!1),s.add(c.colorCode),A!==S&&D.reverse(),p.push(c)}o.totalFaces+=d.totalFaces}return l&&(t.applyMaterialsToMesh(y,l.colorCode,o.materials),y.userData.colorCode=l.colorCode),o};for(let o=0,l=e.faces;o<l;o++)s.add(e.faces[o].colorCode);if(await h(e),t.smoothNormals){const o=s.size>1;Be(e.faces),Ge(e.faces,e.lineSegments,o)}const f=e.group;return e.faces.length>0&&f.add(J(this.loader,e.faces,3,!1,e.totalFaces)),e.lineSegments.length>0&&f.add(J(this.loader,e.lineSegments,2)),e.conditionalSegments.length>0&&f.add(J(this.loader,e.conditionalSegments,2,!0)),f}hasCachedModel(e){return e!==null&&e.toLowerCase()in this._cache}async getCachedModel(e){if(e!==null&&this.hasCachedModel(e)){const t=e.toLowerCase();return(await this._cache[t]).clone()}else return null}async loadModel(e){const t=this.parseCache,r=e.toLowerCase();if(this.hasCachedModel(e))return this.getCachedModel(e);{await t.ensureDataLoaded(e);const s=t.getData(e),h=this.processIntoMesh(s);return this.hasCachedModel(e)?this.getCachedModel(e):(me(s.type)&&(this._cache[r]=h),(await h).clone())}}async parseModel(e){const r=this.parseCache.parse(e);return me(r.type)&&this.hasCachedModel(r.fileName)?this.getCachedModel(r.fileName):this.processIntoMesh(r)}}function ze(I,e){return I.colorCode===e.colorCode?0:I.colorCode<e.colorCode?-1:1}function J(I,e,t,r=!1,s=null){e.sort(ze),s===null&&(s=e.length);const h=new Float32Array(t*s*3),f=t===3?new Float32Array(t*s*3):null,o=[],l=new Array(6),i=new _e;let F=null,y=0,n=0,E=0;for(let u=0,d=e.length;u<d;u++){const L=e[u];let C=L.vertices;C.length===4&&(l[0]=C[0],l[1]=C[1],l[2]=C[2],l[3]=C[0],l[4]=C[2],l[5]=C[3],C=l);for(let p=0,M=C.length;p<M;p++){const w=C[p],k=E+p*3;h[k+0]=w.x,h[k+1]=w.y,h[k+2]=w.z}if(t===3){if(!L.faceNormal){const M=C[0],w=C[1],k=C[2];$.subVectors(w,M),K.subVectors(k,w),L.faceNormal=new B().crossVectors($,K).normalize()}let p=L.normals;p.length===4&&(l[0]=p[0],l[1]=p[1],l[2]=p[2],l[3]=p[0],l[4]=p[2],l[5]=p[3],p=l);for(let M=0,w=p.length;M<w;M++){let k=L.faceNormal;p[M]&&(k=p[M].norm);const T=E+M*3;f[T+0]=k.x,f[T+1]=k.y,f[T+2]=k.z}}if(F!==L.colorCode){F!==null&&i.addGroup(y,n,o.length-1);const p=L.material;if(p!==null){if(t===3)o.push(p);else if(t===2)if(r){const M=I.edgeMaterialCache.get(p);o.push(I.conditionalEdgeMaterialCache.get(M))}else o.push(I.edgeMaterialCache.get(p))}else o.push(L.colorCode);F=L.colorCode,y=E/3,n=C.length}else n+=C.length;E+=3*C.length}n>0&&i.addGroup(y,n,o.length-1),i.setAttribute("position",new j(h,3)),f!==null&&i.setAttribute("normal",new j(f,3));let m=null;if(t===2?r?m=new We(i,o.length===1?o[0]:o):m=new fe(i,o.length===1?o[0]:o):t===3&&(m=new xe(i,o.length===1?o[0]:o)),r){m.isConditionalLine=!0;const u=new Float32Array(e.length*3*2),d=new Float32Array(e.length*3*2),L=new Float32Array(e.length*3*2);for(let C=0,p=e.length;C<p;C++){const M=e[C],w=M.vertices,k=M.controlPoints,T=k[0],S=k[1],A=w[0],v=w[1],a=C*3*2;u[a+0]=T.x,u[a+1]=T.y,u[a+2]=T.z,u[a+3]=T.x,u[a+4]=T.y,u[a+5]=T.z,d[a+0]=S.x,d[a+1]=S.y,d[a+2]=S.z,d[a+3]=S.x,d[a+4]=S.y,d[a+5]=S.z,L[a+0]=v.x-A.x,L[a+1]=v.y-A.y,L[a+2]=v.z-A.z,L[a+3]=v.x-A.x,L[a+4]=v.y-A.y,L[a+5]=v.z-A.z}i.setAttribute("control0",new j(u,3,!1)),i.setAttribute("control1",new j(d,3,!1)),i.setAttribute("direction",new j(L,3,!1))}return m}class Ke extends z{constructor(e){super(e),this.materials=[],this.materialLibrary={},this.edgeMaterialCache=new WeakMap,this.conditionalEdgeMaterialCache=new WeakMap,this.partsCache=new Ye(this),this.fileMap={},this.smoothNormals=!0,this.partsLibraryPath="",this.ConditionalLineMaterial=null,this.missingColorMaterial=new W({name:z.DEFAULT_MATERIAL_NAME,color:16711935,roughness:.3,metalness:0}),this.missingEdgeColorMaterial=new se({name:z.DEFAULT_MATERIAL_NAME,color:16711935}),this.missingConditionalEdgeColorMaterial=null,this.edgeMaterialCache.set(this.missingColorMaterial,this.missingEdgeColorMaterial),this.conditionalEdgeMaterialCache.set(this.missingEdgeColorMaterial,this.missingConditionalEdgeColorMaterial)}setPartsLibraryPath(e){return this.partsLibraryPath=e,this}setConditionalLineMaterial(e){return this.ConditionalLineMaterial=e,this.missingConditionalEdgeColorMaterial=new this.ConditionalLineMaterial({name:z.DEFAULT_MATERIAL_NAME,fog:!0,color:16711935}),this}async preloadMaterials(e){const t=new Q(this.manager);t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials);const r=await t.loadAsync(e),s=/^0 !COLOUR/,h=r.split(/[\n\r]/g),f=[];for(let o=0,l=h.length;o<l;o++){const i=h[o];if(s.test(i)){const F=i.replace(s,""),y=this.parseColorMetaDirective(new H(F));f.push(y)}}this.addMaterials(f)}load(e,t,r,s){const h=new Q(this.manager);h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,f=>{this.addDefaultMaterials(),this.partsCache.parseModel(f).then(o=>{this.applyMaterialsToMesh(o,P,this.materialLibrary,!0),this.computeBuildingSteps(o),o.userData.fileName=e,t(o)}).catch(s)},r,s)}parse(e,t,r){this.partsCache.parseModel(e).then(s=>{this.applyMaterialsToMesh(s,P,this.materialLibrary,!0),this.computeBuildingSteps(s),s.userData.fileName="",t(s)}).catch(r)}setMaterials(e){return this.clearMaterials(),this.addMaterials(e),this}clearMaterials(){return this.materialLibrary={},this.materials=[],this}addMaterials(e){for(let t=0,r=e.length;t<r;t++)this.addMaterial(e[t]);return this}addDefaultMaterials(){return this.addMaterial(this.parseColorMetaDirective(new H("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333"))),this.addMaterial(this.parseColorMetaDirective(new H("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))),this}setFileMap(e){return this.fileMap=e,this}addMaterial(e){const t=this.materialLibrary;return t[e.userData.code]||(this.materials.push(e),t[e.userData.code]=e),this}getMaterial(e){if(e.startsWith("0x2")){const t=e.substring(3);return this.parseColorMetaDirective(new H("Direct_Color_"+t+" CODE -1 VALUE #"+t+" EDGE #"+t))}return this.materialLibrary[e]||null}applyMaterialsToMesh(e,t,r,s=!1){const h=this,f=t===P;e.traverse(l=>{if(l.isMesh||l.isLineSegments)if(Array.isArray(l.material))for(let i=0,F=l.material.length;i<F;i++)l.material[i].isMaterial||(l.material[i]=o(l,l.material[i]));else l.material.isMaterial||(l.material=o(l,l.material))});function o(l,i){if(f&&!(i in r)&&!s)return i;const F=l.isLineSegments||l.isConditionalLine;(!F&&i===P||F&&i===G)&&(i=t);let n=null;if(i in r)n=r[i];else if(s)n=h.getMaterial(i),n===null&&(console.warn(`LDrawLoader: Material properties for code ${i} not available.`),n=h.missingColorMaterial);else return i;return l.isLineSegments&&(n=h.edgeMaterialCache.get(n),l.isConditionalLine&&(n=h.conditionalEdgeMaterialCache.get(n))),n}}getMainMaterial(){return this.getMaterial(P)}getMainEdgeMaterial(){const e=this.getMaterial(G);return e?this.edgeMaterialCache.get(e):null}parseColorMetaDirective(e){let t=null,r="#FF00FF",s="#FF00FF",h=1,f=!1,o=0,l=oe,i=null;const F=e.getToken();if(!F)throw new Error('LDrawLoader: Material name was expected after "!COLOUR tag'+e.getLineNumberString()+".");let y=null;for(;y=e.getToken(),!!y;)if(!E(y))switch(y.toUpperCase()){case"CODE":t=e.getToken();break;case"VALUE":if(r=e.getToken(),r.startsWith("0x"))r="#"+r.substring(2);else if(!r.startsWith("#"))throw new Error("LDrawLoader: Invalid color while parsing material"+e.getLineNumberString()+".");break;case"EDGE":if(s=e.getToken(),s.startsWith("0x"))s="#"+s.substring(2);else if(!s.startsWith("#")){if(i=this.getMaterial(s),!i)throw new Error("LDrawLoader: Invalid edge color while parsing material"+e.getLineNumberString()+".");i=this.edgeMaterialCache.get(i)}break;case"ALPHA":if(h=parseInt(e.getToken()),isNaN(h))throw new Error("LDrawLoader: Invalid alpha value in material definition"+e.getLineNumberString()+".");h=Math.max(0,Math.min(1,h/255)),h<1&&(f=!0);break;case"LUMINANCE":if(!E(e.getToken()))throw new Error("LDrawLoader: Invalid luminance value in material definition"+e.getLineNumberString()+".");break;case"CHROME":l=ie;break;case"PEARLESCENT":l=le;break;case"RUBBER":l=ce;break;case"MATTE_METALLIC":l=he;break;case"METAL":l=ue;break;case"MATERIAL":e.setToEnd();break;default:throw new Error('LDrawLoader: Unknown token "'+y+'" while parsing material'+e.getLineNumberString()+".")}let n=null;switch(l){case oe:n=new W({roughness:.3,metalness:0});break;case le:n=new W({roughness:.3,metalness:.25});break;case ie:n=new W({roughness:0,metalness:1});break;case ce:n=new W({roughness:.9,metalness:0});break;case he:n=new W({roughness:.8,metalness:.4});break;case ue:n=new W({roughness:.2,metalness:.85});break}if(n.color.setStyle(r,q),n.transparent=f,n.opacity=h,n.depthWrite=!f,n.polygonOffset=!0,n.polygonOffsetFactor=1,o!==0&&n.emissive.setStyle(r,q).multiplyScalar(o),!i){if(i=new se({color:new ne().setStyle(s,q),transparent:f,opacity:h,depthWrite:!f}),i.color,i.userData.code=t,i.name=F+" - Edge",this.ConditionalLineMaterial===null)throw new Error("THREE.LDrawLoader: ConditionalLineMaterial type must be specified via .setConditionalLineMaterial().");const m=new this.ConditionalLineMaterial({fog:!0,transparent:f,depthWrite:!f,color:new ne().setStyle(s,q),opacity:h});m.userData.code=t,m.name=F+" - Conditional Edge",this.conditionalEdgeMaterialCache.set(i,m)}return n.userData.code=t,n.name=F,this.edgeMaterialCache.set(n,i),this.addMaterial(n),n;function E(m){let u;return m.startsWith("LUMINANCE")?u=parseInt(m.substring(9)):u=parseInt(m),isNaN(u)?!1:(o=Math.max(0,Math.min(1,u/255)),!0)}}computeBuildingSteps(e){let t=0;e.traverse(r=>{r.isGroup&&(r.userData.startingBuildingStep&&t++,r.userData.buildingStep=t)}),e.userData.numBuildingSteps=t+1}}export{Ke as LDrawLoader};
