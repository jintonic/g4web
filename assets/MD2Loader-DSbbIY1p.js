import{L as q,F as M,q as N,H as L,r as y,a6 as H}from"./main-z5BJ3CM8.js";const R=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class S extends q{constructor(d){super(d)}load(d,e,o,v){const r=this,m=new M(r.manager);m.setPath(r.path),m.setResponseType("arraybuffer"),m.setRequestHeader(r.requestHeader),m.setWithCredentials(r.withCredentials),m.load(d,function(t){try{e(r.parse(t))}catch(u){v?v(u):console.error(u),r.manager.itemError(d)}},o,v)}parse(d){const e=new DataView(d),o={},v=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let s=0;s<v.length;s++)o[v[s]]=e.getInt32(s*4,!0);if(o.ident!==844121161||o.version!==8){console.error("Not a valid MD2 file");return}if(o.offset_end!==e.byteLength){console.error("Corrupted MD2 file");return}const r=new N,m=[];let t=o.offset_st;for(let s=0,f=o.num_st;s<f;s++){const i=e.getInt16(t+0,!0),n=e.getInt16(t+2,!0);m.push(i/o.skinwidth,1-n/o.skinheight),t+=4}t=o.offset_tris;const u=[],z=[];for(let s=0,f=o.num_tris;s<f;s++)u.push(e.getUint16(t+0,!0),e.getUint16(t+2,!0),e.getUint16(t+4,!0)),z.push(e.getUint16(t+6,!0),e.getUint16(t+8,!0),e.getUint16(t+10,!0)),t+=12;const I=new L,b=new L,x=[];t=o.offset_frames;for(let s=0,f=o.num_frames;s<f;s++){b.set(e.getFloat32(t+0,!0),e.getFloat32(t+4,!0),e.getFloat32(t+8,!0)),I.set(e.getFloat32(t+12,!0),e.getFloat32(t+16,!0),e.getFloat32(t+20,!0)),t+=24;const i=[];for(let a=0;a<16;a++){const c=e.getUint8(t+a);if(c===0)break;i[a]=c}const n={name:String.fromCharCode.apply(null,i),vertices:[],normals:[]};t+=16;for(let a=0;a<o.num_vertices;a++){let c=e.getUint8(t++),l=e.getUint8(t++),h=e.getUint8(t++);const g=R[e.getUint8(t++)];c=c*b.x+I.x,l=l*b.y+I.y,h=h*b.z+I.z,n.vertices.push(c,h,l),n.normals.push(g[0],g[2],g[1])}x.push(n)}const C=[],k=[],j=[],F=x[0].vertices,A=x[0].normals;for(let s=0,f=u.length;s<f;s++){let n=u[s]*3;const a=F[n],c=F[n+1],l=F[n+2];C.push(a,c,l);const h=A[n],g=A[n+1],p=A[n+2];k.push(h,g,p),n=z[s]*2;const _=m[n],w=m[n+1];j.push(_,w)}r.setAttribute("position",new y(C,3)),r.setAttribute("normal",new y(k,3)),r.setAttribute("uv",new y(j,2));const T=[],D=[];for(let s=0,f=x.length;s<f;s++){const i=x[s],n=i.name;if(i.vertices.length>0){const a=[];for(let l=0,h=u.length;l<h;l++){const p=u[l]*3,U=i.vertices[p],_=i.vertices[p+1],w=i.vertices[p+2];a.push(U,_,w)}const c=new y(a,3);c.name=n,T.push(c)}if(i.normals.length>0){const a=[];for(let l=0,h=u.length;l<h;l++){const p=u[l]*3,U=i.normals[p],_=i.normals[p+1],w=i.normals[p+2];a.push(U,_,w)}const c=new y(a,3);c.name=n,D.push(c)}}return r.morphAttributes.position=T,r.morphAttributes.normal=D,r.morphTargetsRelative=!1,r.animations=H.CreateClipsFromMorphTargetSequences(x,10,!1),r}}export{S as MD2Loader};
